# Checklist: Global MCP Server Installation & Multi-Tool Sync

Generated: 2025-10-25T10:29:04.520Z
Feature Branch: 20251025-171852-spec-global-mcp-multi-tool
Scope: Apply same MCP servers across Claude (project), Gemini (global), Copilot (detect/unsupported); verify Claude correctness; prevent drift.

## Pre-flight
- [ ] On correct branch: git branch --show-current | grep -q "20251025-171852-spec-global-mcp-multi-tool"
- [ ] Clean tree: test -z "$(git status --porcelain)"
- [ ] Constitution exists: test -f .specify/memory/constitution.md
- [ ] Secret scan clean: git ls-files | xargs -r grep -l -E "(ghp_[A-Za-z0-9]{36}|ghs_[A-Za-z0-9]{36}|sk-[A-Za-z0-9]{48})" | wc -l | grep -q '^0$'

## US1: One-click multi-tool profile sync
- [ ] Profiles dir exists: test -d ~/.config/mcp-profiles || echo "Create and add <profile>.json"
- [ ] Switch profile: scripts/mcp/mcp-profile dev --tool=all
- [ ] Claude keys == profile keys:
      jq -r --arg p "$(git rev-parse --show-toplevel)" '(.projects[$p].mcpServers//{})|keys|sort' ~/.claude.json | diff -u - <(jq -r 'keys|sort' ~/.config/mcp-profiles/dev.json)
- [ ] Gemini keys == profile keys:
      jq -r '(.mcpServers//{})|keys|sort' ~/.config/gemini/settings.json | diff -u - <(jq -r 'keys|sort' ~/.config/mcp-profiles/dev.json)

## US2: Claude verification (CLI-first, boxed, real calls)
- [ ] Run tests: scripts/mcp/mcp-profile test
- [ ] Boxed headers present (â‰ˆ5): scripts/mcp/mcp-profile test | grep "\xe2\x94\x8c\xe2\x94\x80\xe2\x94\x80\xe2\x94\x80\xe2\x94\x80\xe2\x94\x80" | wc -l | grep -Eq '^[5-9]$'
- [ ] Real calls present in script (>=5):
      grep -c "gh auth status\|gh api\|hf auth whoami\|claude mcp list\|curl.*context7" scripts/mcp/mcp-profile | grep -E '^[5-9]$'
- [ ] Color codes present (>20): grep -c "\\033\[0;3" scripts/mcp/mcp-profile | grep -E '^[2-9][0-9]$'
- [ ] Verify helper passes:
      scripts/mcp/mcp-profile verify | tee /tmp/mcp-verify.out >/dev/null && \
      grep -qi "Claude matches profile" /tmp/mcp-verify.out && \
      grep -qi "Gemini matches profile" /tmp/mcp-verify.out

## US3: Drift protection
- [ ] Local CI guard active: scripts/local-ci/run.sh --skip-tests || true; grep -q "Guard: scripts/mcp/mcp-profile changed" logs/ci-*.log || echo "OK (no unintended changes)"
- [ ] Commit policy: ensure any commit that modifies scripts/mcp/mcp-profile includes text: allow-mcp-profile-update
- [ ] Merge via PR with --no-ff; never delete branches

## Copilot CLI
- [ ] Status shows unsupported: scripts/mcp/mcp-profile status --tool=copilot | grep -qi "unsupported"
- [ ] No write attempts to Copilot; Claude/Gemini unaffected

## Backups
- [ ] Claude backup created today in ~/.config/claude-code/backups
- [ ] Gemini backup created today in ~/.config/gemini/backups

## Documentation
- [ ] Update README with --tool=copilot (unsupported), verify command, and drift guard note
- [ ] Link SPEC-KIT-SAFETY.md rollback steps from scripts/mcp/README.md

## Exit criteria
- [ ] SC-001/002 pass (key equality for Claude/Gemini)
- [ ] Test output has boxed sections with CLI-first order
- [ ] Drift guard in place and CI run green
