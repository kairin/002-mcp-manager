{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Deployment State Tracking",
  "description": "JSON schema for tracking GitHub Pages deployment history and last known good state",
  "type": "object",
  "required": ["currentDeployment", "lastKnownGood"],
  "properties": {
    "currentDeployment": {
      "type": "object",
      "description": "Most recent deployment attempt (success or failure)",
      "required": [
        "deployment_id",
        "timestamp",
        "commit_sha",
        "status",
        "git_operations_attempts"
      ],
      "properties": {
        "deployment_id": {
          "type": "string",
          "pattern": "^deploy-\\d+$",
          "description": "Unique deployment identifier (format: deploy-{timestamp})",
          "examples": ["deploy-1729433445", "deploy-1729433500"]
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Deployment time in ISO 8601 format",
          "examples": ["2025-10-20T14:30:45Z", "2025-10-20T14:31:40Z"]
        },
        "commit_sha": {
          "type": "string",
          "minLength": 40,
          "maxLength": 40,
          "pattern": "^[0-9a-f]{40}$",
          "description": "Git commit SHA (40 hex characters)",
          "examples": [
            "5c04b60a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e",
            "7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b"
          ]
        },
        "status": {
          "type": "string",
          "enum": ["success", "failure", "rolled_back"],
          "description": "Deployment outcome"
        },
        "git_operations_attempts": {
          "type": "integer",
          "minimum": 1,
          "maximum": 3,
          "description": "Number of git push attempts (1-3)"
        },
        "error_message": {
          "type": "string",
          "description": "Failure reason (only present if status=failure)",
          "examples": [
            "Git operations failed after 3 attempts: remote rejected push",
            "Build failed: TypeScript compilation errors"
          ]
        }
      }
    },
    "lastKnownGood": {
      "type": "object",
      "description": "Reference to last successful deployment for rollback",
      "required": ["deployment_id", "commit_sha", "timestamp"],
      "properties": {
        "deployment_id": {
          "type": "string",
          "pattern": "^deploy-\\d+$",
          "description": "Deployment ID of last successful deployment"
        },
        "commit_sha": {
          "type": "string",
          "minLength": 40,
          "maxLength": 40,
          "pattern": "^[0-9a-f]{40}$",
          "description": "Git commit SHA of last successful deployment"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of last successful deployment"
        }
      }
    },
    "history": {
      "type": "array",
      "description": "Optional deployment history (last 10 entries, oldest first)",
      "maxItems": 10,
      "items": {
        "type": "object",
        "required": [
          "deployment_id",
          "timestamp",
          "commit_sha",
          "status",
          "git_operations_attempts"
        ],
        "properties": {
          "deployment_id": {
            "type": "string",
            "pattern": "^deploy-\\d+$"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          },
          "commit_sha": {
            "type": "string",
            "minLength": 40,
            "maxLength": 40,
            "pattern": "^[0-9a-f]{40}$"
          },
          "status": {
            "type": "string",
            "enum": ["success", "failure", "rolled_back"]
          },
          "git_operations_attempts": {
            "type": "integer",
            "minimum": 1,
            "maximum": 3
          },
          "error_message": {
            "type": "string"
          }
        }
      }
    }
  },
  "examples": [
    {
      "currentDeployment": {
        "deployment_id": "deploy-1729433445",
        "timestamp": "2025-10-20T14:30:45Z",
        "commit_sha": "5c04b60a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e",
        "status": "success",
        "git_operations_attempts": 1
      },
      "lastKnownGood": {
        "deployment_id": "deploy-1729433445",
        "commit_sha": "5c04b60a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e",
        "timestamp": "2025-10-20T14:30:45Z"
      },
      "history": [
        {
          "deployment_id": "deploy-1729433400",
          "timestamp": "2025-10-20T14:30:00Z",
          "commit_sha": "3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f",
          "status": "success",
          "git_operations_attempts": 2
        }
      ]
    },
    {
      "currentDeployment": {
        "deployment_id": "deploy-1729433500",
        "timestamp": "2025-10-20T14:31:40Z",
        "commit_sha": "7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b",
        "status": "failure",
        "git_operations_attempts": 3,
        "error_message": "Git operations failed after 3 attempts: remote rejected push"
      },
      "lastKnownGood": {
        "deployment_id": "deploy-1729433445",
        "commit_sha": "5c04b60a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e",
        "timestamp": "2025-10-20T14:30:45Z"
      },
      "history": [
        {
          "deployment_id": "deploy-1729433445",
          "timestamp": "2025-10-20T14:30:45Z",
          "commit_sha": "5c04b60a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e",
          "status": "success",
          "git_operations_attempts": 1
        },
        {
          "deployment_id": "deploy-1729433500",
          "timestamp": "2025-10-20T14:31:40Z",
          "commit_sha": "7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b",
          "status": "failure",
          "git_operations_attempts": 3,
          "error_message": "Git operations failed after 3 attempts: remote rejected push"
        }
      ]
    }
  ]
}
